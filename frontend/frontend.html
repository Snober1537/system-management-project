<!-- frontend.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory Management System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 2em; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f4f4f4; }
        input, button { margin: 0.5em 0; }
        .error { color: red; font-size: 0.9em; margin: 0.5em 0; display: none; }
        .success { color: green; font-size: 0.9em; margin: 0.5em 0; display: none; }
    </style>
</head>
<body>
    <h1>Inventory Management System</h1>

    <h2>Add Item</h2>
    <form id="addForm">
        <input type="text" id="name" placeholder="Name" required>
        <input type="number" id="quantity" placeholder="Quantity" required>
        <input type="text" id="description" placeholder="Description">
        <button type="submit">Add</button>
    </form>

    <h2>Search Items</h2>
    <input type="text" id="search" placeholder="Search by name">
    <button onclick="searchItems()">Search</button>

    <h2>Inventory List</h2>
    <table id="itemsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const API_URL = 'http://localhost:8080';
        
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            return errorDiv;
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            return successDiv;
        }

        function clearMessages() {
            const messages = document.querySelectorAll('.error, .success');
            messages.forEach(msg => msg.remove());
        }

        function validateForm() {
            const name = document.getElementById('name').value.trim();
            const quantity = document.getElementById('quantity').value.trim();
            
            if (!name || !quantity) {
                return showError('Please fill in all required fields');
            }
            
            if (isNaN(quantity) || quantity <= 0) {
                return showError('Please enter a valid quantity (must be greater than 0)');
            }
            
            return null;
        }

        function fetchItems() {
            clearMessages();
            fetch(`${API_URL}/items`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error('Failed to fetch items');
                    }
                    return res.json();
                })
                .then(items => renderTable(items))
                .catch(error => {
                    document.getElementById('addForm').insertBefore(showError(error.message), document.getElementById('addForm').firstChild);
                });
        }

        function renderTable(items) {
            const tbody = document.querySelector('#itemsTable tbody');
            tbody.innerHTML = '';
            if (items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No items found</td></tr>';
                return;
            }
            items.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>
                            <input type="number" value="${item.quantity}" min="0" id="qty-${item.id}" 
                                oninput="validateQuantity(${item.id})">
                        </td>
                        <td>${item.description || ''}</td>
                        <td>
                            <button onclick="updateItem(${item.id})">Update</button>
                            <button onclick="deleteItem(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }

        function validateQuantity(id) {
            const qtyInput = document.getElementById(`qty-${id}`);
            const quantity = qtyInput.value;
            
            if (isNaN(quantity) || quantity <= 0) {
                qtyInput.style.borderColor = 'red';
                return false;
            } else {
                qtyInput.style.borderColor = '';
                return true;
            }
        }

        document.getElementById('addForm').onsubmit = function(e) {
            e.preventDefault();
            const validationError = validateForm();
            if (validationError) {
                document.getElementById('addForm').insertBefore(validationError, document.getElementById('addForm').firstChild);
                return;
            }
            
            const name = document.getElementById('name').value;
            const quantity = document.getElementById('quantity').value;
            const description = document.getElementById('description').value;
            
            fetch(`${API_URL}/items`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, quantity, description })
            })
            .then(res => {
                if (!res.ok) {
                    throw new Error('Failed to add item');
                }
                return res.json();
            })
            .then(() => {
                document.getElementById('addForm').insertBefore(showSuccess('Item added successfully'), document.getElementById('addForm').firstChild);
                fetchItems();
                this.reset();
            })
            .catch(error => {
                document.getElementById('addForm').insertBefore(showError(error.message), document.getElementById('addForm').firstChild);
            });
        };

        function updateItem(id) {
            const quantity = document.getElementById(`qty-${id}`).value;
            
            if (!validateQuantity(id)) {
                return;
            }
            
            fetch(`${API_URL}/items/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ quantity })
            })
            .then(res => {
                if (!res.ok) {
                    throw new Error('Failed to update item');
                }
                return res.json();
            })
            .then(() => {
                const element = document.getElementById(`qty-${id}`).parentElement.parentElement;
                element.insertBefore(showSuccess('Updated successfully'), element.firstChild);
                setTimeout(() => {
                    const successMsg = element.querySelector('.success');
                    if (successMsg) successMsg.remove();
                }, 3000);
            })
            .catch(error => {
                const element = document.getElementById(`qty-${id}`).parentElement.parentElement;
                element.insertBefore(showError(error.message), element.firstChild);
            });
        }

        function deleteItem(id) {
            if (!confirm('Are you sure you want to delete this item?')) {
                return;
            }
            
            fetch(`${API_URL}/items/${id}`, { method: 'DELETE' })
                .then(res => {
                    if (!res.ok) {
                        throw new Error('Failed to delete item');
                    }
                    return res.json();
                })
                .then(() => {
                    const element = document.getElementById(`qty-${id}`).parentElement.parentElement;
                    element.insertBefore(showSuccess('Deleted successfully'), element.firstChild);
                    setTimeout(() => {
                        const successMsg = element.querySelector('.success');
                        if (successMsg) successMsg.remove();
                    }, 3000);
                    fetchItems();
                })
                .catch(error => {
                    const element = document.getElementById(`qty-${id}`).parentElement.parentElement;
                    element.insertBefore(showError(error.message), element.firstChild);
                });
        }

        function searchItems() {
            const query = document.getElementById('search').value;
            clearMessages();
            fetch(`${API_URL}/items/search?q=${encodeURIComponent(query)}`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error('Failed to search items');
                    }
                    return res.json();
                })
                .then(items => renderTable(items))
                .catch(error => {
                    const searchElement = document.getElementById('search');
                    searchElement.insertAdjacentElement('afterend', showError(error.message));
                });
        }

        // Initial load
        fetchItems();
    </script>
</body>
</html>